<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.reply.dao.IReplyDao">
	<select id="getReplyCountByParent" parameterType="com.study.reply.vo.ReplySearchVO" resultType="int">
		SELECT COUNT(*)
		FROM reply
		WHERE re_parent_no = #{reParentNo}
		  AND re_category = #{reCategory}
	</select>
	
	<select id="getReplyListByParent" parameterType="com.study.reply.vo.ReplySearchVO" resultType="com.study.reply.vo.ReplyVO">
		SELECT *
			FROM (
				SELECT a.*, ROWNUM AS rnum
				FROM (
					SELECT re_no, re_category, re_parent_no, re_mem_id,
					       (SELECT mem_name FROM member WHERE re_mem_id = mem_id) AS re_mem_name,
					       re_content, re_ip,
					       TO_CHAR(re_reg_date, 'YYYY/MM/DD HH24:MI') AS re_reg_date,
					       TO_CHAR(re_mod_date, 'YYYY/MM/DD HH24:MI') AS re_mod_date
					FROM reply
					WHERE re_parent_no = #{reParentNo}
					  AND re_category = #{reCategory}
					ORDER BY re_no
				) a
			) b
		WHERE rnum BETWEEN #{firstRow} AND #{lastRow}
	</select>
	
	<select id="getReply" parameterType="int" resultType="com.study.reply.vo.ReplyVO">
		SELECT *
		FROM reply
		WHERE re_no = #{a}
	</select>
	
	<select id="insertReply" parameterType="com.study.reply.vo.ReplyVO" resultType="int">
		INSERT INTO reply
				VALUES (
					SEQ_REPLY.NEXTVAL,
    				#{reCategory},
    				#{reParentNo},
    				#{reMemId},
    				#{reContent},
    				#{reIp},
    				SYSDATE,
    				SYSDATE
				)
	</select>
	
	<select id="updateReply" parameterType="com.study.reply.vo.ReplyVO" resultType="int">
		UPDATE reply
		SET re_content = #{reContent}
		WHERE re_no = #{reNo}
	</select>
	
	<select id="deleteReply" parameterType="com.study.reply.vo.ReplyVO" resultType="int">
		DELETE FROM reply
		WHERE re_no = #{reNo}
	</select>
</mapper>