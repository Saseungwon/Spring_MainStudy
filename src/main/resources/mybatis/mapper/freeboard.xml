<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.free.dao.IFreeBoardDao">
	<sql id="search">
		<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchCategory)">
			AND bo_category = #{searchCategory}
		</if>
		<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchWord)">
			<choose>
				<when test='searchType=="T"'>
					AND bo_title LIKE '%' || #{searchWord} || '%'
				</when>
				<when test='searchType=="W"'>
					AND bo_writer LIKE '%' || #{searchWord} || '%'
				</when>
				<when test='searchType=="C"'>
					AND bo_content LIKE '%' || #{searchWord} || '%'
				</when>
			</choose>
		</if>
	</sql>

	<!-- id 메소드 이름 -->
	<select id="getBoardCount" parameterType="com.study.free.vo.FreeBoardSearchVO" resultType="int">
		SELECT COUNT(*)
		FROM free_board
		WHERE 1 = 1
		<include refid="search"></include>
	</select>
	
	<!-- return 타입이 List일 때 <>안에 있는것을 작성 -->
	<select id="getBoardList" parameterType="com.study.free.vo.FreeBoardSearchVO" resultType="com.study.free.vo.FreeBoardVO">
		SELECT *
		FROM
			(SELECT a.*, ROWNUM AS rnum
			 FROM
			 	(SELECT bo_no,      bo_title,    bo_category,
				    	 b.comm_nm AS bo_category_nm,
				        bo_writer,  bo_pass,     bo_content,
			 	        bo_ip,      bo_hit,
				        TO_CHAR(bo_reg_date,'YYYY-MM-DD') AS bo_reg_date,
				        TO_CHAR(bo_mod_date,'YYYY-MM-DD') AS bo_mod_date,
				        bo_del_yn
				 FROM free_board a, comm_code b
				 WHERE 1 = 1
				   AND a.bo_category = b.comm_cd
				   <include refid="search"></include>
				 ORDER BY bo_no
				) a
			) b
		WHERE rnum BETWEEN #{firstRow} AND #{lastRow}
	</select>
	
	<select id="getBoard" parameterType="int" resultType="com.study.free.vo.FreeBoardVO">
		SELECT bo_no,      bo_title,    bo_category,
	       	b.comm_nm AS bo_category_nm,
		       bo_writer,  bo_pass,     bo_content,
		       bo_ip,      bo_hit,
		       TO_CHAR(bo_reg_date, 'YYYY-MM-DD') AS bo_reg_date,
		       TO_CHAR(bo_mod_date, 'YYYY-MM-DD') AS bo_mod_date,
		       bo_del_yn
		FROM free_board a, comm_code  b
		WHERE bo_no = #{a}
		  AND a.bo_category = b.comm_cd
	</select>
	
	<select id="increaseHit" parameterType="int">
		UPDATE free_board SET
			bo_hit = bo_hit + 1
		WHERE bo_no = #{a}
	</select>
	
	<select id="insertBoard" parameterType="com.study.free.vo.FreeBoardVO">
		INSERT INTO free_board VALUES ( 
			SEQ_FREE_BOARD.NEXTVAL,
			#{boTitle},
			#{boCategory},
			#{boWriter},
			#{boPass},
			#{boContent},
			#{boIp},
			0,
			SYSDATE,
			NULL,
			'N'
		)
	</select>
	
	<select id="updateBoard" parameterType="com.study.free.vo.FreeBoardVO">
		UPDATE free_board SET
			bo_title = #{boTitle},
			bo_category = #{boCategory},
			bo_content = #{boContent},
			bo_mod_date = SYSDATE
		WHERE bo_no = #{boNo}
	</select>
	
	<select id="deleteBoard" parameterType="com.study.free.vo.FreeBoardVO">
		UPDATE free_board SET bo_del_yn = 'Y'
		WHERE bo_no = #{boNo}
	</select>
</mapper>